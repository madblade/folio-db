{"title":"The Spearman correlation formula","author":"M. S","date":"2019/01/10","thumb":"assets/img/craft/lance.jpg","body":[{"type":0,"content":"I. Context"},{"type":2,"content":"There are two equivalent formulations of <a href=\"https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient\">Spearman’s rho</a>. The claim is as follows: "},{"type":7,"content":"\\frac{\\sum_i(x_i-\\bar x)(y_i-\\bar y)}{\\sqrt{\\sum_i(x_i-\\bar x)^2 \\sum_i(y_i-\\bar y)^2}} = 1 - \\frac{6 \\sum_i(y_i-x_i)^2}{n(n^2-1)}"},{"type":2,"content":"This is well-known in statistics. Let’s try to unroll the demonstration step by step and test equation rendering on this blog."},{"type":0,"content":"II. Rank correlation"},{"type":2,"content":"Spearman’s rho measures the similarity between two rankings. When <small>$x$</small> and <small>$y$</small> are ranking variables, that is, two lists of <small>$n$</small> elements where the <small>$i^{th}$</small> element gives the rank of a specific entity, rho is the <a href=\"https://en.wikipedia.org/wiki/Pearson_correlation_coefficient\">bivariate correlation</a> between <small>$x$</small> and <small>$y$</small>. In other words, it is the covariance of <small>$x$</small> and <small>$y$</small> divided by the product of their standard deviation. "},{"type":7,"content":"\\rho = \\frac{\\text{cov}(x,y)}{\\sigma(x)\\sigma(y)} "},{"type":2,"content":"By definition, the standard deviation of a variable is the square root of its variance, which is the expected square of the deviation between the variable and its expected value. "},{"type":7,"content":"\\sigma(x) = \\sqrt{ \\mathbf{E}[(x - \\mathbf{E}[x])^2] }"},{"type":2,"content":"By definition, the covariance of two variables is the expected product of their deviation from their expected values. "},{"type":7,"content":"\\text{cov}(x,y) = \\mathbf{E}[(x - \\mathbf{E}[x])(y - \\mathbf{E}[y])]"},{"type":2,"content":"In statistics, the expectation of a variable hints at its most representative value. In a nutshell, it is the probability-weighted average of all possible values the variable could have. Here the bar notation represents the average. "},{"type":7,"content":"\\mathbf{E}(x) = \\bar x"},{"type":2,"content":"Summing up: "},{"type":7,"content":"\\rho = \\frac{ \\mathbf{E}[(x - \\bar x)(y - \\bar y)] }{ \\sqrt{ \\mathbf{E}[(x - \\bar x)^2] }  \\sqrt{ \\mathbf{E}[(y - \\bar y)^2] } } "},{"type":2,"content":"The expected value of a variable is just its probability-weighted average, so, taking <small>$i$</small> ranging from <small>$1$</small> to <small>$n$</small> for indexing possible values of <small>$x$</small> and <small>$y$</small>, numerator and denominator are computed as follows: "},{"type":7,"content":"\\\\\\mathbf{E}[(x - \\bar x)(y - \\bar y)] = \\frac{1}{n^2} \\sum_i(x_i-\\bar x)(y_i-\\bar y) \\\\[1em]\\sqrt{ \\mathbf{E}[(x - \\bar x)^2] }  \\sqrt{ \\mathbf{E}[(y - \\bar y)^2] } = \\sqrt{ \\frac{1}{n^2} \\sum_i(x_i-\\bar x)^2 } \\sqrt{ \\frac{1}{n^2} \\sum_i(y_i-\\bar y)^2 } \\\\[1em]  = \\frac{1}{n^2} \\sqrt{  \\sum_i(x_i-\\bar x)^2 \\sum_i(y_i-\\bar y)^2 } \\\\[0.5em] "},{"type":2,"content":"As factors cancel out, we are left with the following formula that will go through a bit of refactoring in the next section: "},{"type":7,"content":"\\rho = \\frac{\\sum_i(x_i-\\bar x)(y_i-\\bar y)}{\\sqrt{\\sum_i(x_i-\\bar x)^2 \\sum_i(y_i-\\bar y)^2}} "},{"type":0,"content":"III. Ranks without ties: detailed reformulation"},{"type":2,"content":"Keep in mind, we are working with two variables that represent the ranking of some fixed collection of entities. Assuming there are no ties in either ranking, Spearman’s rho can be simplified. First thing to notice is how the means are constant: "},{"type":7,"content":" \\bar x = \\bar y = \\frac{n+1}{2}"},{"type":2,"content":"Looking at the denominator, it must also be constant. Notice how just rearranging the way variables are summed in the denominator does not change the value of the sum. "},{"type":7,"content":"\\sum_i(x_i-\\bar x)^2 = \\sum_i(y_i-\\bar y)^2 = \\sum_i(i-\\frac{n+1}{2})^2 "},{"type":2,"content":"That way, the denominator is just: "},{"type":7,"content":"\\sqrt{\\sum_i(x_i-\\bar x)^2 \\sum_i(y_i-\\bar y)^2} = \\sum_i(x_i-\\bar x)^2 "},{"type":2,"content":"At this point, since we are interested in the value of this multiplicative constant, it seems that there is little choice but to actually do some computation. So, distributing, splitting sums and factorizing: "},{"type":7,"content":" \\\\\\sum_i(x_i-\\bar x)^2 = \\sum_i(x_i^2 - 2 x_i\\bar x + \\bar x^2) \\\\[1em]= \\sum_ix_i^2 - 2 \\bar x \\sum_ix_i + \\bar x^2 \\sum_i 1 \\\\[1em]= \\sum_ii^2 - 2 \\frac{n+1}{2} \\sum_ii + (\\frac{n+1}{2})^2 \\sum_i 1 \\\\[1em]= \\frac{n(n+1)(2n+1)}{6} - (n+1) \\frac{n(n+1)}{2} + (\\frac{n+1}{2})^2n \\\\[1em]= \\frac{n(n+1)}{2} ( \\frac{1}{3}(2n+1) - (n+1) + \\frac{1}{2}(n+1) ) \\\\[1em]= \\frac{n(n+1)}{12} ( 2(2n+1) - 3(n+1) ) \\\\[1em]= \\frac{n(n+1)}{12} ( 4n+2 - 3n-3) ) \\\\[1em]= \\frac{n(n+1)}{12} ( n-1 ) \\\\[1em]= \\frac{n(n^2-1)}{12}\\\\[1em]"},{"type":2,"content":"Now looking at the numerator, distributing the product should yield three constant terms and another one, a product between <small>$x$</small> and <small>$y$</small>, which the original question asked to express in terms of their difference. "},{"type":7,"content":"\\\\\\sum_i(x_i-\\bar x)(y_i-\\bar y) = \\sum_i(x_iy_i-\\bar yx_i-\\bar xy_i+\\bar x\\bar y) \\\\[1em]= C_1 + \\sum_i(x_iy_i) \\\\[1em]"},{"type":2,"content":"The constant terms are just an offset, they should not change the correlation measure whether the input is translated or scaled. Remark that the product can be simply expressed from the difference. "},{"type":7,"content":"\\\\\\sum_i(x_i-y_i)^2 = \\sum_i(x_i^2) + \\sum_i(y_i^2) - 2\\sum_i(x_iy_i) \\\\[1em] \\sum_i(x_iy_i) = C_2 - \\frac{1}{2}\\sum_i(x_i-y_i)^2  \\\\[1em]"},{"type":2,"content":"Plugging everything into rho yields: "},{"type":7,"content":"\\\\\\rho = \\frac{\\sum_i(x_i-\\bar x)(y_i-\\bar y)}{\\sum_i(x_i-\\bar x)^2}\\\\[1em]\\rho = \\frac{12}{n(n^2-1)} (C_1+C_2-\\frac{1}{2}\\sum_i(x_i-y_i)^2) \\\\[1em]\\rho = C_3 - \\frac{6\\sum_i(x_i-y_i)^2}{n(n^2-1)} \\\\[1em]"},{"type":2,"content":"No real computation is needed to find the last constant:"},{"type":7,"content":"\\\\C_3 =  \\frac{1}{\\sum_i(x_i-\\bar x)^2} \\sum_i(\\frac{1}{2}(x_i^2+y_i^2) - x_i\\bar y - y_i\\bar x + \\bar x\\bar y) \\\\[1em]= \\frac{1}{\\sum_i(x_i-\\bar x)^2} \\sum_i(x_i^2 - 2x_i\\bar x + \\bar x^2) \\\\[1em]= 1 \\\\[1em]"},{"type":0,"content":"IV. Digression: remarkable integer sums"},{"type":2,"content":"Sum, definition: "},{"type":7,"content":"\\\\\\sum^n(a) = \\underbrace{a + ... + a}_{n \\text{ times}} \\\\[2em]= n\\times a \\\\[1em]= na \\\\[1em]"},{"type":2,"content":"Simple distributivity, an example demonstration: "},{"type":7,"content":"\\\\n(a+b) = \\sum^n(a+b) \\\\[1em]= \\sum^na + \\sum^nb \\\\[1em]= na + nb \\\\[1em]"},{"type":2,"content":"The sum of ones: "},{"type":7,"content":"\\\\S_0 = \\sum_i^n i^0 = \\sum_i^n 1 = n \\\\[1em]"},{"type":2,"content":"The sum of integers: "},{"type":7,"content":"\\\\S_1 = \\sum_i^n i^1 \\\\[1em]= \\sum_{i=1}^{\\lceil n/2 \\rceil}(i) + \\sum_{i=1}^{\\lceil n/2 \\rceil}(n+1-i) - (n+1)(n \\text{ mod } 2)\\\\[1em]= \\sum_{i=1}^{\\lceil n/2 \\rceil}(n+1) - (n+1)(n \\text{ mod } 2) \\\\[1em]= (n+1)\\lceil n/2 \\rceil - (n+1)(n \\text{ mod } 2) \\\\[1em]= (n+1)(\\lceil n/2 \\rceil - n \\text{ mod } 2) \\\\[1em]= \\frac{n(n+1)}{2} \\\\[1em]"},{"type":2,"content":"The sum of squares: "},{"type":7,"content":"\\\\S_2 = \\sum_i^n i^2 \\\\[1em]\\sum_i^n(i+1)^3 = \\sum_i^n(i^3+3i^2+3i+1) \\\\[1em]\\sum_i^n(i+1)^3 - \\sum_i^ni^3 = \\sum_i^n(3i^2)+\\sum_i^n(3i)+\\sum_i^n(1) \\\\[1em](n+1)^3-1 = 3S_2 + 3\\sum_i^n(i) + \\sum_i^n(1) \\\\[1em]S_2 =\\frac{1}{3}((n+1)^3 - 3\\sum_i^n(i) - \\sum_i^n(1)-1) \\\\[1em]=\\frac{1}{3}((n+1)^3 - 3\\frac{n(n+1)}{2} - n-1) \\\\[1em]=\\frac{1}{3}(\\frac{2}{2}(n+1)^3 - \\frac{3}{2}(n+1)n - \\frac{2}{2}(n+1)) \\\\[1em]=\\frac{1}{6}(n+1)(2(n+1)^2 - 3n - 2) \\\\[1em]=\\frac{1}{6}(n+1)(2n^2 + 4n + 2 - 3n - 2) \\\\[1em]=\\frac{1}{6}(n+1)(2n^2 + n) \\\\[1em]= \\frac{n(n+1)(2n+1)}{6} \\\\[1em]"}],"validated":true,"type":"technical","id":30002}